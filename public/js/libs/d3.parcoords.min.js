d3.parcoords=function(e){function m(e,t,r){d3.keys(t).forEach(function(i){e[i]=function(a){if(!arguments.length)return t[i];"dimensions"===i&&"[object Array]"===Object.prototype.toString.call(a)&&(console.warn("pc.dimensions([]) is deprecated, use pc.dimensions({})"),a=n.applyDimensionDefaults(a));var o=t[i];return t[i]=a,g[i].call(n,{value:a,previous:o}),r[i].call(n,{value:a,previous:o}),e}})}function v(e,t){for(key in t)e[key]=t[key];return e}function y(e,t){return t.forEach(function(t){delete e[t]}),e}function _(){return"bottom"==t.nullValueSeparator?[a()+1-t.nullValueSeparatorPadding.bottom-t.nullValueSeparatorPadding.top,1]:"top"==t.nullValueSeparator?[a()+1,1+t.nullValueSeparatorPadding.bottom+t.nullValueSeparatorPadding.top]:[a()+1,1]}function b(){if(t.brushed&&t.brushed.length!==t.data.length)return!0;var e=B.currentMode().brushState();for(var n in e)if(e.hasOwnProperty(n))return!0;return!1}function w(e){var n=d3.map(),r=d3.map();return t.data.forEach(function(n){var i=t.dimensions[e].yscale(n[e]);r.has(i)||r.set(i,0);var a=r.get(i);r.set(i,a+1)}),t.data.forEach(function(i){d3.keys(t.dimensions).map(function(a,o){var s=t.dimensions[e].yscale(i[e]);if(!n.has(s)){var u=d3.map();n.set(s,u)}n.get(s).has(a)||n.get(s).set(a,0);var l=n.get(s).get(a);l+=t.dimensions[a].yscale(i[a])/r.get(s),n.get(s).set(a,l)})}),n}function T(e){for(var n=[],r=d3.keys(t.dimensions),i=r.length,a=.5,o=0;i>o;++o){var s=j(r[o]),u=t.dimensions[r[o]].yscale(e[r[o]]);if(n.push($V([s,u])),i-1>o){var l=s+a*(j(r[o+1])-s),c=u+a*(t.dimensions[r[o+1]].yscale(e[r[o+1]])-u);if(null!==t.bundleDimension){var f=t.clusterCentroids.get(t.dimensions[t.bundleDimension].yscale(e[t.bundleDimension])).get(r[o]),h=t.clusterCentroids.get(t.dimensions[t.bundleDimension].yscale(e[t.bundleDimension])).get(r[o+1]),p=.5*(f+h);c=p+(1-t.bundlingStrength)*(c-p)}n.push($V([l,c]))}}return n}function L(e){var n=e.length,r=t.smoothness,i=[];i.push(e[0]),i.push($V([e[0].e(1)+2*r*(e[1].e(1)-e[0].e(1)),e[0].e(2)]));for(var a=1;n-1>a;++a){var o=e[a],s=e[a-1],u=e[a+1],l=s.subtract(u);i.push(o.add(l.x(r))),i.push(o),i.push(o.subtract(l.x(r)))}return i.push($V([e[n-1].e(1)+2*r*(e[n-2].e(1)-e[n-1].e(1)),e[n-1].e(2)])),i.push(e[n-1]),i}function A(e,n){var r=T(e),i=L(r);n.moveTo(i[0].e(1),i[0].e(2));for(var a=1;a<i.length;a+=3){if(t.showControlPoints)for(var o=0;3>o;o++)n.fillRect(i[a+o].e(1),i[a+o].e(2),2,2);n.bezierCurveTo(i[a].e(1),i[a].e(2),i[a+1].e(1),i[a+1].e(2),i[a+2].e(1),i[a+2].e(2))}}function S(e,n){n.beginPath(),null!==t.bundleDimension&&t.bundlingStrength>0||t.smoothness>0?A(e,n):N(e,n),n.stroke()}function C(){return"bottom"==t.nullValueSeparator?a()+1:"top"==t.nullValueSeparator?1:(console.log("A value is NULL, but nullValueSeparator is not set; set it to 'bottom' or 'top'."),a()+1)}function N(e,n){d3.entries(t.dimensions).forEach(function(r,i){0==i?n.moveTo(j(r.key),"undefined"==typeof e[r.key]?C():t.dimensions[r.key].yscale(e[r.key])):n.lineTo(j(r.key),"undefined"==typeof e[r.key]?C():t.dimensions[r.key].yscale(e[r.key]))})}function P(e,n){return null!==t.brushedColor?h.brushed.strokeStyle=d3.functor(t.brushedColor)(e,n):h.brushed.strokeStyle=d3.functor(t.color)(e,n),S(e,h.brushed)}function O(e,n){return h.foreground.strokeStyle=d3.functor(t.color)(e,n),S(e,h.foreground)}function M(e,n){return h.highlight.strokeStyle=d3.functor(t.color)(e,n),S(e,h.highlight)}function I(e){n.svg.selectAll(".dimension");n.flip(e),d3.select(this.parentElement).transition().duration(1100).call(c.scale(t.dimensions[e].yscale)),n.render()}function D(){var e=d3.event.deltaY;e=0>e?-5:e,e=e>0?5:e,t.dimensionTitleRotation+=e,n.svg.selectAll("text.label").attr("transform","translate(0,-5) rotate("+t.dimensionTitleRotation+")"),d3.event.preventDefault()}function q(e){return t.dimensions[e].title?t.dimensions[e].title:e}function U(e){t.brushed=e,r.brush.call(n,t.brushed),n.renderBrushed()}function F(e){if(!arguments.length)return B.predicate;if(e=String(e).toUpperCase(),"AND"!==e&&"OR"!==e)throw"Invalid predicate "+e;return B.predicate=e,t.brushed=B.currentMode().selected(),n.renderBrushed(),n}function j(e){0===s.range().length&&s.rangePoints([0,i()],1);var t=u[e];return null==t?s(e):t}var t={data:[],highlighted:[],dimensions:{},dimensionTitleRotation:0,brushed:!1,brushedColor:null,alphaOnBrushed:0,mode:"default",rate:20,width:600,height:300,margin:{top:24,right:0,bottom:12,left:0},nullValueSeparator:"undefined",nullValueSeparatorPadding:{top:8,right:0,bottom:8,left:0},color:"#069",composite:"source-over",alpha:.7,bundlingStrength:.5,bundleDimension:null,smoothness:0,showControlPoints:!1,hideAxis:[]};v(t,e),e&&e.dimensionTitles&&(console.warn("dimensionTitles passed in config is deprecated. Add title to dimension object."),d3.entries(e.dimensionTitles).forEach(function(e){t.dimensions[e.key]?t.dimensions[e.key].title=t.dimensions[e.key].title?t.dimensions[e.key].title:e.value:t.dimensions[e.key]={title:e.value}}));var f,n=function(e){return e=n.selection=d3.select(e),t.width=e[0][0].clientWidth,t.height=e[0][0].clientHeight,["marks","foreground","brushed","highlight"].forEach(function(t){p[t]=e.append("canvas").attr("class",t)[0][0],h[t]=p[t].getContext("2d")}),n.svg=e.append("svg").attr("width",t.width).attr("height",t.height).append("svg:g").attr("transform","translate("+t.margin.left+","+t.margin.top+")"),n},r=d3.dispatch.apply(this,["render","resize","highlight","brush","brushend","axesreorder"].concat(d3.keys(t))),i=function(){return t.width-t.margin.right-t.margin.left},a=function(){return t.height-t.margin.top-t.margin.bottom},o={brushable:!1,reorderable:!1,axes:!1,interactive:!1,debug:!1},s=d3.scale.ordinal(),u={},c=(d3.svg.line(),d3.svg.axis().orient("left").ticks(5)),h={},p={},g=d3.dispatch.apply(this,d3.keys(t)).on("composite",function(e){h.foreground.globalCompositeOperation=e.value,h.brushed.globalCompositeOperation=e.value}).on("alpha",function(e){h.foreground.globalAlpha=e.value,h.brushed.globalAlpha=e.value}).on("brushedColor",function(e){h.brushed.strokeStyle=e.value}).on("width",function(e){n.resize()}).on("height",function(e){n.resize()}).on("margin",function(e){n.resize()}).on("rate",function(e){x.rate(e.value),E.rate(e.value)}).on("dimensions",function(e){t.dimensions=n.applyDimensionDefaults(d3.keys(e.value)),s.domain(n.getOrderedDimensionKeys()),n.sortDimensions(),o.interactive&&n.render().updateAxes()}).on("bundleDimension",function(e){d3.keys(t.dimensions).length||n.detectDimensions(),n.autoscale(),"number"==typeof e.value?e.value<d3.keys(t.dimensions).length?t.bundleDimension=t.dimensions[e.value]:e.value<t.hideAxis.length&&(t.bundleDimension=t.hideAxis[e.value]):t.bundleDimension=e.value,t.clusterCentroids=w(t.bundleDimension),o.interactive&&n.render()}).on("hideAxis",function(e){n.dimensions(n.applyDimensionDefaults()),n.dimensions(y(t.dimensions,e.value))});n.state=t,n.flags=o,m(n,t,r),d3.rebind(n,r,"on"),n.autoscale=function(){var e={date:function(e){var n=d3.extent(t.data,function(t){return t[e]?t[e].getTime():null});return n[0]===n[1]?d3.scale.ordinal().domain([n[0]]).rangePoints(_()):d3.time.scale().domain(n).range(_())},number:function(e){var n=d3.extent(t.data,function(t){return+t[e]});return n[0]===n[1]?d3.scale.ordinal().domain([n[0]]).rangePoints(_()):d3.scale.linear().domain(n).range(_())},string:function(e){var n={},r=[];return t.data.map(function(r){(void 0!==r[e]||"undefined"===t.nullValueSeparator)&&(void 0===n[r[e]]?n[r[e]]=1:n[r[e]]=n[r[e]]+1)}),r=Object.getOwnPropertyNames(n).sort(function(e,t){return n[e]-n[t]}),d3.scale.ordinal().domain(r).rangePoints(_())}};return d3.keys(t.dimensions).forEach(function(n){t.dimensions[n].yscale||(t.dimensions[n].yscale=e[t.dimensions[n].type](n))}),s.rangePoints([0,i()],1),n.selection.selectAll("canvas").style("margin-top",t.margin.top+"px").style("margin-left",t.margin.left+"px").attr("width",i()+2).attr("height",a()+2),h.foreground.strokeStyle=t.color,h.foreground.lineWidth=.2,h.foreground.globalCompositeOperation=t.composite,h.foreground.globalAlpha=t.alpha,h.brushed.strokeStyle=t.brushedColor,h.brushed.lineWidth=1.4,h.brushed.globalCompositeOperation=t.composite,h.brushed.globalAlpha=t.alpha,h.highlight.lineWidth=3,this},n.scale=function(e,n){return t.dimensions[e].yscale.domain(n),this},n.flip=function(e){return t.dimensions[e].yscale.domain(t.dimensions[e].yscale.domain().reverse()),this},n.commonScale=function(e,r){var i=r||"number";"undefined"==typeof e&&(e=!0),d3.keys(t.dimensions).length||n.detectDimensions(),n.autoscale();var a=d3.keys(t.dimensions).filter(function(e){return t.dimensions[e].type==i});if(e){var o=d3.extent(a.map(function(e,n){return t.dimensions[e].yscale.domain()}).reduce(function(e,t){return e.concat(t)}));a.forEach(function(e){t.dimensions[e].yscale.domain(o)})}else a.forEach(function(e){t.dimensions[e].yscale.domain(d3.extent(t.data,function(e){return+e[k]}))});return null!==t.bundleDimension&&n.bundleDimension(t.bundleDimension),this},n.detectDimensions=function(){return n.dimensions(n.applyDimensionDefaults()),this},n.applyDimensionDefaults=function(e){var r=n.detectDimensionTypes(t.data);e=e?e:d3.keys(r);var i={},a=0;return e.forEach(function(e){i[e]=t.dimensions[e]?t.dimensions[e]:{},i[e].orient=i[e].orient?i[e].orient:"left",i[e].ticks=i[e].ticks?i[e].ticks:5,i[e].innerTickSize=i[e].innerTickSize?i[e].innerTickSize:6,i[e].outerTickSize=i[e].outerTickSize?i[e].outerTickSize:0,i[e].tickPadding=i[e].tickPadding?i[e].tickPadding:3,i[e].type=i[e].type?i[e].type:r[e],i[e].index=i[e].index?i[e].index:a,a++}),i},n.getOrderedDimensionKeys=function(){return d3.keys(t.dimensions).sort(function(e,n){return d3.ascending(t.dimensions[e].index,t.dimensions[n].index)})},n.toType=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},n.toTypeCoerceNumbers=function(e){return parseFloat(e)==e&&null!=e?"number":n.toType(e)},n.detectDimensionTypes=function(e){var t={};return d3.keys(e[0]).forEach(function(r){t[isNaN(Number(r))?r:parseInt(r)]=n.toTypeCoerceNumbers(e[0][r])}),t},n.render=function(){return d3.keys(t.dimensions).length||n.detectDimensions(),n.autoscale(),n.render[t.mode](),r.render.call(this),this},n.renderBrushed=function(){return d3.keys(t.dimensions).length||n.detectDimensions(),n.renderBrushed[t.mode](),r.render.call(this),this},n.render["default"]=function(){n.clear("foreground"),n.clear("highlight"),n.renderBrushed["default"](),t.data.forEach(O)};var E=d3.renderQueue(O).rate(50).clear(function(){n.clear("foreground"),n.clear("highlight")});n.render.queue=function(){n.renderBrushed.queue(),E(t.data)},n.renderBrushed["default"]=function(){n.clear("brushed"),b()&&t.brushed.forEach(P)};var x=d3.renderQueue(P).rate(50).clear(function(){n.clear("brushed")});n.renderBrushed.queue=function(){x(b()?t.brushed:[])},n.shadows=function(){return o.shadows=!0,n.alphaOnBrushed(.1),n.render(),this},n.axisDots=function(e){var e=e||.1,r=n.ctx.marks,i=0,a=2*Math.PI;return r.globalAlpha=d3.min([1/Math.pow(t.data.length,.5),1]),t.data.forEach(function(n){d3.entries(t.dimensions).forEach(function(o,s){r.beginPath(),r.arc(j(o),t.dimensions[o.key].yscale(n[o]),e,i,a),r.stroke(),r.fill()})}),this},n.clear=function(e){return h[e].clearRect(0,0,i()+2,a()+2),"brushed"===e&&b()&&(h.brushed.fillStyle=n.selection.style("background-color"),h.brushed.globalAlpha=1-t.alphaOnBrushed,h.brushed.fillRect(0,0,i()+2,a()+2),h.brushed.globalAlpha=t.alpha),this},d3.rebind(n,c,"ticks","orient","tickValues","tickSubdivide","tickSize","tickPadding","tickFormat"),n.createAxes=function(){return f&&n.removeAxes(),f=n.svg.selectAll(".dimension").data(n.getOrderedDimensionKeys(),function(e){return e}).enter().append("svg:g").attr("class","dimension").attr("transform",function(e){return"translate("+s(e)+")"}),f.append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(e){d3.select(this).call(n.applyAxisConfig(c,t.dimensions[e]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-5) rotate("+t.dimensionTitleRotation+")",x:0,"class":"label"}).text(q).on("dblclick",I).on("wheel",D),"top"==t.nullValueSeparator?n.svg.append("line").attr("x1",0).attr("y1",1+t.nullValueSeparatorPadding.top).attr("x2",i()).attr("y2",1+t.nullValueSeparatorPadding.top).attr("stroke-width",1).attr("stroke","#777").attr("fill","none").attr("shape-rendering","crispEdges"):"bottom"==t.nullValueSeparator&&n.svg.append("line").attr("x1",0).attr("y1",a()+1-t.nullValueSeparatorPadding.bottom).attr("x2",i()).attr("y2",a()+1-t.nullValueSeparatorPadding.bottom).attr("stroke-width",1).attr("stroke","#777").attr("fill","none").attr("shape-rendering","crispEdges"),o.axes=!0,this},n.removeAxes=function(){return f.remove(),this},n.updateAxes=function(){var e=n.svg.selectAll(".dimension").data(n.getOrderedDimensionKeys());if(e.enter().append("svg:g").attr("class","dimension").attr("transform",function(e){return"translate("+j(e)+")"}).style("opacity",0).append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(e){d3.select(this).call(n.applyAxisConfig(c,t.dimensions[e]))}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-5) rotate("+t.dimensionTitleRotation+")",x:0,"class":"label"}).text(q).on("dblclick",I).on("wheel",D),e.attr("opacity",0),e.select(".axis").transition().duration(1100).each(function(e){d3.select(this).call(n.applyAxisConfig(c,t.dimensions[e]))}),e.select(".label").transition().duration(1100).text(q).attr("transform","translate(0,-5) rotate("+t.dimensionTitleRotation+")"),e.exit().remove(),f=n.svg.selectAll(".dimension"),f.transition().duration(1100).attr("transform",function(e){return"translate("+j(e)+")"}).style("opacity",1),n.svg.selectAll(".axis").transition().duration(1100).each(function(e){d3.select(this).call(n.applyAxisConfig(c,t.dimensions[e]))}),o.brushable&&n.brushable(),o.reorderable&&n.reorderable(),"None"!==n.brushMode()){var r=n.brushMode();n.brushMode("None"),n.brushMode(r)}return this},n.applyAxisConfig=function(e,t){return e.scale(t.yscale).orient(t.orient).ticks(t.ticks).tickValues(t.tickValues).innerTickSize(t.innerTickSize).outerTickSize(t.outerTickSize).tickPadding(t.tickPadding).tickFormat(t.tickFormat)},n.reorderable=function(){return f||n.createAxes(),f.style("cursor","move").call(d3.behavior.drag().on("dragstart",function(e){u[e]=this.__origin__=s(e)}).on("drag",function(e){u[e]=Math.min(i(),Math.max(0,this.__origin__+=d3.event.dx)),n.sortDimensions(),s.domain(n.getOrderedDimensionKeys()),n.render(),f.attr("transform",function(e){return"translate("+j(e)+")"})}).on("dragend",function(e){for(var i=0,a=t.dimensions[e].index,o=this,l=this.parentElement;null!=(o=o.previousElementSibling);)++i;i!==a&&(r.axesreorder.call(n,n.getOrderedDimensionKeys()),i>a?l.insertBefore(this,l.children[a-1]):a+1<l.children.length?l.insertBefore(this,l.children[a+1]):l.appendChild(this)),delete this.__origin__,delete u[e],d3.select(this).transition().attr("transform","translate("+s(e)+")"),n.render()})),o.reorderable=!0,this},n.reorder=function(e){var r=n.getOrderedDimensionKeys()[0];n.sortDimensionsByRowData(e);var i=!1;if(i=r!==n.getOrderedDimensionKeys()[0]){s.domain(n.getOrderedDimensionKeys());var a=t.highlighted.slice(0);n.unhighlight(),f.transition().duration(1500).attr("transform",function(e){return"translate("+s(e)+")"}),n.render(),0!==a.length&&n.highlight(a)}},n.sortDimensionsByRowData=function(e){var n=t.dimensions,r=d3.keys(t.dimensions).sort(function(n,r){var i=t.dimensions[n].yscale(e[n])-t.dimensions[r].yscale(e[r]);return 0===i?n.localeCompare(r):i});t.dimensions={},r.forEach(function(e,r){t.dimensions[e]=n[e],t.dimensions[e].index=r})},n.sortDimensions=function(){var e=t.dimensions,n=d3.keys(t.dimensions).sort(function(e,t){return j(e)-j(t)});t.dimensions={},n.forEach(function(n,r){t.dimensions[n]=e[n],t.dimensions[n].index=r})},n.adjacent_pairs=function(e){for(var t=[],n=0;n<e.length-1;n++)t.push([e[n],e[n+1]]);return t};var B={modes:{None:{install:function(e){},uninstall:function(e){},selected:function(){return[]},brushState:function(){return{}}}},mode:"None",predicate:"AND",currentMode:function(){return this.modes[this.mode]}};return n.brushModes=function(){return Object.getOwnPropertyNames(B.modes)},n.brushMode=function(e){if(0===arguments.length)return B.mode;if(-1===n.brushModes().indexOf(e))throw"pc.brushmode: Unsupported brush mode: "+e;return e!==B.mode&&("None"!==B.mode&&n.brushReset(),B.modes[B.mode].uninstall(n),B.mode=e,B.modes[B.mode].install(),"None"===e?delete n.brushPredicate:n.brushPredicate=F),n},function(){function i(t){return!e[t].empty()}function a(){var n=d3.keys(t.dimensions).filter(i),r=n.map(function(t){return e[t].extent()});if(0===n.length)return t.data;var a={date:function(e,n,i){return"function"==typeof t.dimensions[n].yscale.rangePoints?r[i][0]<=t.dimensions[n].yscale(e[n])&&t.dimensions[n].yscale(e[n])<=r[i][1]:r[i][0]<=e[n]&&e[n]<=r[i][1]},number:function(e,n,i){return"function"==typeof t.dimensions[n].yscale.rangePoints?r[i][0]<=t.dimensions[n].yscale(e[n])&&t.dimensions[n].yscale(e[n])<=r[i][1]:r[i][0]<=e[n]&&e[n]<=r[i][1]},string:function(e,n,i){return r[i][0]<=t.dimensions[n].yscale(e[n])&&t.dimensions[n].yscale(e[n])<=r[i][1]}};return t.data.filter(function(e){switch(B.predicate){case"AND":return n.every(function(n,r){return a[t.dimensions[n].type](e,n,r)});case"OR":return n.some(function(n,r){return a[t.dimensions[n].type](e,n,r)});default:throw"Unknown brush predicate "+t.brushPredicate}})}function o(r){if("undefined"==typeof r){var r={};return d3.keys(t.dimensions).forEach(function(t){var n=e[t];if(void 0!==n&&!n.empty()){var i=n.extent();i.sort(d3.ascending),r[t]=i}}),r}var i={};f.selectAll(".brush").each(function(e){i[e]=d3.select(this)}),d3.keys(t.dimensions).forEach(function(t){if(void 0!==r[t]){var n=e[t];void 0!==n&&(n.extent(r[t]),n(i[t]),n.event(i[t]))}}),n.renderBrushed()}function s(i){var o=d3.svg.brush();return o.y(t.dimensions[i].yscale).on("brushstart",function(){null!==d3.event.sourceEvent&&d3.event.sourceEvent.stopPropagation()}).on("brush",function(){U(a())}).on("brushend",function(){r.brushend.call(n,t.brushed)}),e[i]=o,o}function u(r){return t.brushed=!1,f&&(f.selectAll(".brush").each(function(t){d3.select(this).call(e[t].clear())}),n.renderBrushed()),this}function l(){return f||n.createAxes(),f.append("svg:g").attr("class","brush").each(function(e){d3.select(this).call(s(e))}).selectAll("rect").style("visibility",null).attr("x",-15).attr("width",30),n.brushExtents=o,n.brushReset=u,n}var e={};B.modes["1D-axes"]={install:l,uninstall:function(){f.selectAll(".brush").remove(),e={},delete n.brushExtents,delete n.brushReset},selected:a,brushState:o}}(),function(){function u(e,t){var r=n.selection.select("svg").select("g#strums"),i=e.dims.i,a=[e.p1,e.p2],o=r.selectAll("line#strum-"+i).data([e]),s=r.selectAll("circle#strum-"+i).data(a),l=d3.behavior.drag();o.enter().append("line").attr("id","strum-"+i).attr("class","strum"),o.attr("x1",function(e){return e.p1[0]}).attr("y1",function(e){return e.p1[1]}).attr("x2",function(e){return e.p2[0]}).attr("y2",function(e){return e.p2[1]}).attr("stroke","black").attr("stroke-width",2),l.on("drag",function(t,n){var r=d3.event;n+=1,e["p"+n][0]=Math.min(Math.max(e.minX+1,r.x),e.maxX),e["p"+n][1]=Math.min(Math.max(e.minY,r.y),e.maxY),u(e,n-1)}).on("dragend",g()),s.enter().append("circle").attr("id","strum-"+i).attr("class","strum"),s.attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]}).attr("r",5).style("opacity",function(e,n){return void 0!==t&&n===t?.8:0}).on("mouseover",function(){d3.select(this).style("opacity",.8)}).on("mouseout",function(){d3.select(this).style("opacity",0)}).call(l)}function l(e){var r={i:-1,left:void 0,right:void 0};return d3.keys(t.dimensions).some(function(i,a){if(s(i)<e[0]){var o=d3.keys(t.dimensions)[n.getOrderedDimensionKeys().indexOf(i)+1];return r.i=a,r.left=i,r.right=o,!1}return!0}),void 0===r.left?(r.i=0,r.left=n.getOrderedDimensionKeys()[0],r.right=n.getOrderedDimensionKeys()[1]):void 0===r.right&&(r.i=d3.keys(t.dimensions).length-1,r.right=r.left,r.left=n.getOrderedDimensionKeys()[d3.keys(t.dimensions).length-2]),r}function c(){return function(){var r,i,n=d3.mouse(o[0][0]);n[0]=n[0]-t.margin.left,n[1]=n[1]-t.margin.top,r=l(n),i={p1:n,dims:r,minX:s(r.left),maxX:s(r.right),minY:0,maxY:a()},e[r.i]=i,e.active=r.i,i.p1[0]=Math.min(Math.max(i.minX,n[0]),i.maxX),i.p2=i.p1.slice()}}function f(){return function(){var n=d3.event,r=e[e.active];r.p2[0]=Math.min(Math.max(r.minX+1,n.x-t.margin.left),r.maxX),r.p2[1]=Math.min(Math.max(r.minY,n.y-t.margin.top),r.maxY),u(r,1)}}function h(e,t){var n=[e.p1[0]-e.minX,e.p1[1]-e.minX],r=[e.p2[0]-e.minX,e.p2[1]-e.minX],i=1-t/n[0],a=n[1]*(1-i),o=1-t/r[0],s=r[1]*(1-o);return function(e){var t=e[0],n=e[1],r=i*t+a,u=o*t+s;return n>Math.min(r,u)&&n<Math.max(r,u)?!0:!1}}function p(){function i(n,r){var i=e[r],a=h(i,e.width(r)),o=i.dims.left,s=i.dims.right,u=t.dimensions[o].yscale,l=t.dimensions[s].yscale,c=[u(n[o])-i.minX,l(n[s])-i.minX];return a(c)}var n=Object.getOwnPropertyNames(e),r=t.data;return n=n.filter(function(e){return!isNaN(e)}),0===n.length?r:r.filter(function(e){switch(B.predicate){case"AND":return n.every(function(t){return i(e,t)});case"OR":return n.some(function(t){return i(e,t)});default:throw"Unknown brush predicate "+t.brushPredicate}})}function d(){var t=e[e.active],r=n.selection.select("svg").select("g#strums");delete e[e.active],e.active=void 0,r.selectAll("line#strum-"+t.dims.i).remove(),r.selectAll("circle#strum-"+t.dims.i).remove()}function g(){return function(){var i=t.data,a=e[e.active];a&&a.p1[0]===a.p2[0]&&a.p1[1]===a.p2[1]&&d(e),i=p(e),e.active=void 0,t.brushed=i,n.renderBrushed(),r.brushend.call(n,t.brushed)}}function m(e){return function(){var t=Object.getOwnPropertyNames(e).filter(function(e){return!isNaN(e)});t.forEach(function(t){e.active=t,d(e)}),g(e)()}}function v(){var r=d3.behavior.drag();e.active=void 0,e.width=function(t){var n=e[t];return void 0===n?void 0:n.maxX-n.minX},n.on("axesreorder.strums",function(){function r(e,n){var r=d3.keys(t.dimensions).length;return d3.keys(t.dimensions).some(function(i,a){return i===e?r>a+a&&t.dimensions[a+1]===n:!1})}var n=Object.getOwnPropertyNames(e).filter(function(e){return!isNaN(e)});n.length>0&&(n.forEach(function(t){var n=e[t].dims;e.active=t,r(n.left,n.right)||d(e)}),g(e)())}),n.selection.select("svg").append("g").attr("id","strums").attr("transform","translate("+t.margin.left+","+t.margin.top+")"),n.brushReset=m(e),r.on("dragstart",c(e)).on("drag",f(e)).on("dragend",g(e)),o=n.selection.select("svg").insert("rect","g#strums").attr("id","strum-events").attr("x",t.margin.left).attr("y",t.margin.top).attr("width",i()).attr("height",a()+2).style("opacity",0).call(r)}var o,e={};B.modes["2D-strums"]={install:v,uninstall:function(){n.selection.select("svg").select("g#strums").remove(),n.selection.select("svg").select("rect#strum-events").remove(),n.on("axesreorder.strums",void 0),delete n.brushReset,o=void 0},selected:p,brushState:function(){return e}}}(),function(){function i(t){return!e[t].empty()}function a(){var n=d3.keys(t.dimensions).filter(i),r=n.map(function(t){return e[t].extent()});if(0===n.length)return t.data;var a={date:function(e,n,r,i){return"function"==typeof t.dimensions[n].yscale.rangePoints?i[0]<=t.dimensions[n].yscale(e[n])&&t.dimensions[n].yscale(e[n])<=i[1]:i[0]<=e[n]&&e[n]<=i[1]},number:function(e,n,r,i){return"function"==typeof t.dimensions[n].yscale.rangePoints?i[0]<=t.dimensions[n].yscale(e[n])&&t.dimensions[n].yscale(e[n])<=i[1]:i[0]<=e[n]&&e[n]<=i[1]},string:function(e,n,r,i){return i[0]<=t.dimensions[n].yscale(e[n])&&t.dimensions[n].yscale(e[n])<=i[1]}};return t.data.filter(function(e){switch(B.predicate){case"AND":return n.every(function(n,i){return r[i].some(function(r){return a[t.dimensions[n].type](e,n,i,r)})});case"OR":return n.some(function(n,i){return r[i].some(function(r){return a[t.dimensions[n].type](e,n,i,r)})});default:throw"Unknown brush predicate "+t.brushPredicate}})}function o(){var n={};return d3.keys(t.dimensions).forEach(function(t){var r=e[t];if(void 0!==r&&!r.empty()){var i=r.extent();n[t]=i}}),n}function s(i){var o=d3.svg.multibrush();return o.y(t.dimensions[i].yscale).on("brushstart",function(){null!==d3.event.sourceEvent&&d3.event.sourceEvent.stopPropagation()}).on("brush",function(){U(a())}).on("brushend",function(){U(a()),r.brushend.call(n,t.brushed)}).extentAdaption(function(e){e.style("visibility",null).attr("x",-15).attr("width",30)}).resizeAdaption(function(e){e.selectAll("rect").attr("x",-15).attr("width",30)}),e[i]=o,o}function u(r){return t.brushed=!1,f&&(f.selectAll(".brush").each(function(t){d3.select(this).call(e[t].clear())}),n.renderBrushed()),this}function l(){return f||n.createAxes(),f.append("svg:g").attr("class","brush").each(function(e){d3.select(this).call(s(e))}).selectAll("rect").style("visibility",null).attr("x",-15).attr("width",30),n.brushExtents=o,n.brushReset=u,n}if("function"==typeof d3.svg.multibrush){var e={};B.modes["1D-axes-multi"]={install:l,uninstall:function(){f.selectAll(".brush").remove(),e={},delete n.brushExtents,delete n.brushReset},selected:a,brushState:o}}}(),function(){function u(t,r){var i=n.selection.select("svg").select("g#arcs"),a=t.dims.i,o=[t.p2,t.p3],s=i.selectAll("line#arc-"+a).data([{p1:t.p1,p2:t.p2},{p1:t.p1,p2:t.p3}]),l=i.selectAll("circle#arc-"+a).data(o),c=d3.behavior.drag(),f=i.selectAll("path#arc-"+a).data([t]);f.enter().append("path").attr("id","arc-"+a).attr("class","arc").style("fill","orange").style("opacity",.5),f.attr("d",t.arc).attr("transform","translate("+t.p1[0]+","+t.p1[1]+")"),s.enter().append("line").attr("id","arc-"+a).attr("class","arc"),s.attr("x1",function(e){return e.p1[0]}).attr("y1",function(e){return e.p1[1]}).attr("x2",function(e){return e.p2[0]}).attr("y2",function(e){return e.p2[1]}).attr("stroke","black").attr("stroke-width",2),c.on("drag",function(n,r){var i=d3.event,o=0;r+=2,t["p"+r][0]=Math.min(Math.max(t.minX+1,i.x),t.maxX),t["p"+r][1]=Math.min(Math.max(t.minY,i.y),t.maxY),o=3===r?e.startAngle(a):e.endAngle(a),(t.startAngle<Math.PI&&t.endAngle<Math.PI&&o<Math.PI||t.startAngle>=Math.PI&&t.endAngle>=Math.PI&&o>=Math.PI)&&(2===r?(t.endAngle=o,t.arc.endAngle(o)):3===r&&(t.startAngle=o,t.arc.startAngle(o))),u(t,r-2)}).on("dragend",_()),l.enter().append("circle").attr("id","arc-"+a).attr("class","arc"),l.attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]}).attr("r",5).style("opacity",function(e,t){return void 0!==r&&t===r?.8:0}).on("mouseover",function(){d3.select(this).style("opacity",.8)}).on("mouseout",function(){d3.select(this).style("opacity",0)}).call(c)}function l(e){var r={i:-1,left:void 0,right:void 0};return d3.keys(t.dimensions).some(function(i,a){if(s(i)<e[0]){var o=d3.keys(t.dimensions)[n.getOrderedDimensionKeys().indexOf(i)+1];return r.i=a,r.left=i,r.right=o,!1}return!0}),void 0===r.left?(r.i=0,r.left=n.getOrderedDimensionKeys()[0],r.right=n.getOrderedDimensionKeys()[1]):void 0===r.right&&(r.i=d3.keys(t.dimensions).length-1,r.right=r.left,r.left=n.getOrderedDimensionKeys()[d3.keys(t.dimensions).length-2]),r}function c(){return function(){var r,i,n=d3.mouse(o[0][0]);n[0]=n[0]-t.margin.left,n[1]=n[1]-t.margin.top,r=l(n),i={p1:n,dims:r,minX:s(r.left),maxX:s(r.right),minY:0,maxY:a(),startAngle:void 0,endAngle:void 0,arc:d3.svg.arc().innerRadius(0)},e[r.i]=i,e.active=r.i,i.p1[0]=Math.min(Math.max(i.minX,n[0]),i.maxX),i.p2=i.p1.slice(),i.p3=i.p1.slice()}}function f(){return function(){var n=d3.event,r=e[e.active];r.p2[0]=Math.min(Math.max(r.minX+1,n.x-t.margin.left),r.maxX),r.p2[1]=Math.min(Math.max(r.minY,n.y-t.margin.top),r.maxY),r.p3=r.p2.slice(),u(r,1)}}function h(e,t){return Math.sqrt(e*e+t*t)}function m(e){var t=g(e.startAngle),n=g(e.endAngle);if(t>n){var r=t;t=n,n=r}return function(e){return e>=t&&n>=e?!0:!1}}function v(){function i(n,r){var i=e[r],a=m(i),o=i.dims.left,s=i.dims.right,u=t.dimensions[o].yscale,l=t.dimensions[s].yscale,c=e.width(r),f=u(n[o])-l(n[s]),p=h(c,f),d=Math.asin(f/p);return a(d)}var n=Object.getOwnPropertyNames(e),r=t.data;return n=n.filter(function(e){return!isNaN(e)}),0===n.length?r:r.filter(function(e){switch(B.predicate){case"AND":return n.every(function(t){return i(e,t)});case"OR":return n.some(function(t){return i(e,t)});default:throw"Unknown brush predicate "+t.brushPredicate}})}function y(){var t=e[e.active],r=n.selection.select("svg").select("g#arcs");delete e[e.active],e.active=void 0,r.selectAll("line#arc-"+t.dims.i).remove(),r.selectAll("circle#arc-"+t.dims.i).remove(),r.selectAll("path#arc-"+t.dims.i).remove()}function _(){return function(){var i=t.data,a=e[e.active];if(a&&a.p1[0]===a.p2[0]&&a.p1[1]===a.p2[1]&&y(e),a){var o=e.startAngle(e.active);a.startAngle=o,a.endAngle=o,a.arc.outerRadius(e.length(e.active)).startAngle(o).endAngle(o)}i=v(e),e.active=void 0,t.brushed=i,n.renderBrushed(),r.brushend.call(n,t.brushed)}}function b(e){return function(){var t=Object.getOwnPropertyNames(e).filter(function(e){return!isNaN(e)});t.forEach(function(t){e.active=t,y(e)}),_(e)()}}function E(){var r=d3.behavior.drag();e.active=void 0,e.width=function(t){var n=e[t];return void 0===n?void 0:n.maxX-n.minX},angle=function(e,t){var n=e[0]-t[0],r=e[1]-t[1],i=h(n,r);return Math.asin(r/i)},e.endAngle=function(t){var n=e[t];if(void 0===n)return void 0;var r=angle(n.p1,n.p2),i=-r+Math.PI/2;return n.p1[0]>n.p2[0]&&(i=2*Math.PI-i),i},e.startAngle=function(t){var n=e[t];if(void 0===n)return void 0;var r=angle(n.p1,n.p3),i=-r+Math.PI/2;return n.p1[0]>n.p3[0]&&(i=2*Math.PI-i),i},e.length=function(t){var n=e[t];if(void 0===n)return void 0;var r=n.p1[0]-n.p2[0],i=n.p1[1]-n.p2[1],a=h(r,i);return a},n.on("axesreorder.arcs",function(){function r(e,n){var r=d3.keys(t.dimensions).length;return d3.keys(t.dimensions).some(function(i,a){return i===e?r>a+a&&t.dimensions[a+1]===n:!1})}var n=Object.getOwnPropertyNames(e).filter(function(e){return!isNaN(e)});n.length>0&&(n.forEach(function(t){var n=e[t].dims;e.active=t,r(n.left,n.right)||y(e)}),_(e)())}),n.selection.select("svg").append("g").attr("id","arcs").attr("transform","translate("+t.margin.left+","+t.margin.top+")"),n.brushReset=b(e),r.on("dragstart",c(e)).on("drag",f(e)).on("dragend",_(e)),o=n.selection.select("svg").insert("rect","g#arcs").attr("id","arc-events").attr("x",t.margin.left).attr("y",t.margin.top).attr("width",i()).attr("height",a()+2).style("opacity",0).call(r)}var o,e={},g=(function(){var e=Math.PI/180;return function(t){return t*e}}(),function(){var e=180/Math.PI;return function(t){return t*e}}(),function(e){var t=e;return e>Math.PI?(t=e-1.5*Math.PI,t=e-1.5*Math.PI):(t=e-.5*Math.PI,t=e-.5*Math.PI),-t});B.modes.angular={install:E,uninstall:function(){n.selection.select("svg").select("g#arcs").remove(),n.selection.select("svg").select("rect#arc-events").remove(),n.on("axesreorder.arcs",void 0),delete n.brushReset,o=void 0},selected:v,brushState:function(){return e}}}(),n.interactive=function(){return o.interactive=!0,this},n.xscale=s,n.ctx=h,n.canvas=p,n.g=function(){return f},n.resize=function(){return n.selection.select("svg").attr("width",t.width).attr("height",t.height),n.svg.attr("transform","translate("+t.margin.left+","+t.margin.top+")"),o.brushable&&n.brushReset(),n.autoscale(),f&&n.createAxes(),o.brushable&&n.brushable(),o.reorderable&&n.reorderable(),r.resize.call(this,{width:t.width,height:t.height,margin:t.margin}),this},n.highlight=function(e){return 0===arguments.length?t.highlighted:(t.highlighted=e,n.clear("highlight"),d3.selectAll([p.foreground,p.brushed]).classed("faded",!0),e.forEach(M),r.highlight.call(this,e),this)},n.unhighlight=function(){return t.highlighted=[],n.clear("highlight"),d3.selectAll([p.foreground,p.brushed]).classed("faded",!1),this},n.intersection=function(e,t,n,r){return{x:((e.x*t.y-e.y*t.x)*(n.x-r.x)-(e.x-t.x)*(n.x*r.y-n.y*r.x))/((e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x)),y:((e.x*t.y-e.y*t.x)*(n.y-r.y)-(e.y-t.y)*(n.x*r.y-n.y*r.x))/((e.x-t.x)*(n.y-r.y)-(e.y-t.y)*(n.x-r.x))
}},n.version="0.7.0",n.toString=function(){return"Parallel Coordinates: "+d3.keys(t.dimensions).length+" dimensions ("+d3.keys(t.data[0]).length+" total) , "+t.data.length+" rows"},n},d3.renderQueue=function(e){var t=[],n=10,r=function(){},i=0,a=function(e){e&&a.data(e),a.invalidate(),r(),a.render()};return a.render=function(){function o(){if(!r)return!0;if(i>t.length)return!0;for(var a=Math.min(i+n,t.length),o=i;a>o;o++)e(t[o],o);i+=n}i=0;var r=!0;a.invalidate=function(){r=!1},d3.timer(o)},a.data=function(e){return a.invalidate(),t=e.slice(0),a},a.rate=function(e){return arguments.length?(n=e,a):n},a.remaining=function(){return t.length-i},a.clear=function(e){return arguments.length?(r=e,a):(r(),a)},a.invalidate=function(){},a};